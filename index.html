<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tem Metrô Lá</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { display: flex; justify-content: center; background-color: #f3f4f6; margin: 0; font-family: sans-serif; }
        .app-container { width: 100%; max-width: 430px; height: 100vh; position: relative; background: white; overflow: hidden; }
        #map { height: 100%; width: 100%; }
        .station-list { max-height: 200px; overflow-y: auto; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="absolute top-0 left-0 right-0 z-30 bg-gradient-to-b from-blue-800 to-transparent pt-4 pb-10 px-6 pointer-events-none">
        <h1 class="text-white text-xl font-black tracking-tighter uppercase">Tem Metrô Lá?</h1>
    </div>

    <div class="absolute top-16 left-0 right-0 z-20 px-4">
        <div class="bg-white rounded-xl shadow-2xl p-2 flex items-center space-x-2 border border-gray-200">
            <input type="text" id="pac-input" placeholder="Digitar endereço..." class="flex-grow outline-none text-sm p-2">
            <button id="search-btn" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-bold">
                PESQUISAR
            </button>
        </div>
    </div>

    <div id="map"></div>

    <div class="absolute bottom-0 left-0 right-0 bg-white rounded-t-[24px] shadow-[0_-5px_20px_rgba(0,0,0,0.1)] z-40 px-5 pt-2 pb-6">
        <div class="flex justify-center mb-3"><div class="w-10 h-1 bg-gray-200 rounded-full"></div></div>
        
        <h2 class="text-sm font-bold text-gray-500 uppercase mb-3">Estações Próximas</h2>
        <div id="list-container" class="station-list space-y-3">
            <p class="text-xs text-gray-400">Buscando sua localização...</p>
        </div>
    </div>
</div>

<script>
    let map, service, infoWindow, userMarker;
    const apiKey = "AIzaSyAyeljGisp0yk242H4s3VC_xFeBwESDrjU";

    // Cores das linhas de SP (Exemplo para lógica de pins)
    const lineColors = {
        'Azul': 'blue',
        'Verde': 'green',
        'Vermelha': 'red',
        'Amarela': 'yellow',
        'Lilás': 'purple',
        'Prata': 'gray',
        'Esmeralda': 'teal',
        'Diamante': 'orange'
    };

    function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
            zoom: 14,
            disableDefaultUI: true,
            clickableIcons: false
        });

        infoWindow = new google.maps.InfoWindow();

        // 1. Tentar localizar usuário imediatamente
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition((position) => {
                const pos = { lat: position.coords.latitude, lng: position.coords.longitude };
                map.setCenter(pos);
                userMarker = new google.maps.Marker({ position: pos, map: map, title: "Você está aqui" });
                findStations(pos);
            });
        }

        // 2. Configurar Busca
        const input = document.getElementById("pac-input");
        const autocomplete = new google.maps.places.Autocomplete(input);
        
        document.getElementById("search-btn").addEventListener("click", () => {
            const place = autocomplete.getPlace();
            if (place && place.geometry) {
                map.setCenter(place.geometry.location);
                findStations(place.geometry.location);
            }
        });
    }

    function findStations(location) {
        const request = {
            location: location,
            radius: '3000',
            type: ['subway_station', 'transit_station']
        };

        service = new google.maps.places.PlacesService(map);
        service.nearbySearch(request, (results, status) => {
            if (status === google.maps.places.PlacesServiceStatus.OK) {
                renderStations(results);
            }
        });
    }

    function renderStations(places) {
        const listContainer = document.getElementById("list-container");
        listContainer.innerHTML = ""; // Limpa lista

        places.forEach((place) => {
            // Tenta identificar a cor da linha pelo nome (Simplificado)
            let color = "red"; // cor padrão
            for (let line in lineColors) {
                if (place.name.includes(line)) color = lineColors[line];
            }

            // Criar Pin no Mapa
            const marker = new google.maps.Marker({
                position: place.geometry.location,
                map: map,
                title: place.name,
                icon: `http://maps.google.com/mapfiles/ms/icons/${color}-dot.png`
            });

            // Clique no Pin
            marker.addListener("click", () => {
                infoWindow.setContent(`
                    <div style="color: black; padding: 5px;">
                        <b style="font-size: 14px;">${place.name}</b><br>
                        <span style="font-size: 12px;">Estação de Transporte</span><br>
                        <a href="https://www.google.com/maps/dir/?api=1&destination=${place.geometry.location.lat()},${place.geometry.location.lng()}" 
                           target="_blank" 
                           style="display: inline-block; margin-top: 8px; color: blue; font-weight: bold;">
                           Ir para esta estação
                        </a>
                    </div>
                `);
                infoWindow.open(map, marker);
            });

            // Adicionar na Lista Inferior
            const item = document.createElement("div");
            item.className = "flex items-center justify-between p-3 bg-gray-50 rounded-xl border border-gray-100 cursor-pointer hover:bg-gray-100";
            item.innerHTML = `
                <div class="flex items-center space-x-3">
                    <div class="w-2 h-8 rounded-full bg-${color}-500" style="background-color: ${color}"></div>
                    <div>
                        <p class="text-sm font-bold text-gray-800">${place.name}</p>
                        <p class="text-[10px] text-gray-500">${place.vicinity}</p>
                    </div>
                </div>
                <a href="https://www.google.com/maps/dir/?api=1&destination=${place.geometry.location.lat()},${place.geometry.location.lng()}" target="_blank" class="text-blue-600 text-xs font-bold">MAPA</a>
            `;
            item.onclick = () => {
                map.setCenter(place.geometry.location);
                google.maps.event.trigger(marker, 'click');
            };
            listContainer.appendChild(item);
        });
    }
</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAyeljGisp0yk242H4s3VC_xFeBwESDrjU&libraries=places&callback=initMap" async defer></script>

</body>
</html>